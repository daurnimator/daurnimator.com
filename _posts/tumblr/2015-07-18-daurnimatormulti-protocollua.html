---
layout: post
title: daurnimator/multi-protocol.lua
date: '2015-07-18T00:46:37+10:00'
tags:
- programming
- lua
- cqueues
redirect_from: /post/124328696304/daurnimatormulti-protocollua
---
<a href="https://gist.github.com/daurnimator/60fc881c374b56cebd5f">daurnimator/multi-protocol.lua</a><br/><p>This snippet demonstrates listening for multiple protocol signatures on the one TCP port.
I left off concurrency to make it easier to understand.</p>

<p>The TLS path will only work with the newly commited <a href="https://github.com/wahern/cqueues/issues/73">cqueues <code>:starttls</code> pushback</a>, which runs userspace buffered data through the incoming <code>BIO</code> before reading off the socket.</p>

<p>A couple of the protocol patterns I stole from prosody (where a similar idea is done via &lsquo;mod_net_multiplex&rsquo;).</p>
